(()=>{"use strict";const e={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало"},t=e=>{""===e.innerHTML&&e.remove()},r=document.querySelector("#card").content.querySelector(".popup"),o=(e,t)=>{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();t("Ошибка загрузки данных!")})).then((t=>e(t))).catch((()=>{t("Ошибка загрузки данных!")}))},n=document.querySelector("main"),a=e=>{const t=document.querySelector(`#${e}`).content.querySelector(`.${e}`).cloneNode(!0);return t.style.zIndex=1100,t.classList.add("hidden"),t},i=e=>{const t=document.querySelector(`.${e}`);t.classList.remove("hidden");const r=()=>t.classList.add("hidden"),o=e=>{((e,t)=>{"Escape"===e.key&&t()})(e,r),document.removeEventListener("keydown",o),document.removeEventListener("click",n)},n=()=>{r(),document.removeEventListener("keydown",o),document.removeEventListener("click",n)};document.addEventListener("keydown",o),document.addEventListener("click",n)},l={bungalow:0,flat:1e3,house:5e3,palace:1e4},s={1:[2],2:[1,2],3:[0,1,2],100:[3]},c=document.querySelector("#title"),d=document.querySelector("#type"),u=document.querySelector("#price"),p=document.querySelector("#timein"),y=document.querySelector("#timeout");d.addEventListener("change",(()=>{u.placeholder=l[d.value],u.setAttribute("min",l[d.value])})),p.addEventListener("change",(()=>y.value=p.value)),y.addEventListener("change",(()=>p.value=y.value));const m=document.querySelector("#room_number"),f=document.querySelector("#capacity"),v=f.querySelectorAll("option"),h=()=>{v.forEach((e=>e.disabled=!0)),"1"===m.value&&(f[2].disabled=!1),f[2].selected=!0};m.addEventListener("click",(()=>{h(),f.selectedIndex=-1,f.setCustomValidity("Необходимо выбрать количество гостей"),f.style.border="3px solid red",s[m.value].forEach((e=>f[e].disabled=!1))})),f.addEventListener("change",(()=>{f.setCustomValidity(""),f.style.border="none"})),c.addEventListener("input",(()=>{c.style.border="3px solid red",c.validity.tooShort?c.setCustomValidity("Заголовок объявления должен состоять минимум из 30 символов"):c.validity.tooLong?c.setCustomValidity("Заголовок объявления не должен превышать 100 символов"):c.validity.valueMissing?c.setCustomValidity("Обязательное для заполнения поле"):(c.setCustomValidity(""),c.style.border="none")})),u.addEventListener("input",(()=>{u.style.border="3px solid red",u.validity.rangeUnderflow?u.setCustomValidity(`Минимальная цена ${u.getAttribute("min")} руб.`):u.validity.rangeOverflow?u.setCustomValidity(`Максимальная цена ${u.getAttribute("max")} руб.`):u.validity.valueMissing?u.setCustomValidity("Обязательное для заполнения поле"):(u.setCustomValidity(""),u.style.border="none")}));const g=["gif","jpg","jpeg","png"],S=document.querySelector("#avatar"),q=document.querySelector(".ad-form-header__preview img"),b=document.querySelector("#images"),x=document.querySelector(".ad-form__photo");x.style.overflow="hidden";const k=(e,t)=>{const r=e.files[0],o=r.name.toLowerCase();if(g.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.style.objectFit="cover",t.src=e.result})),e.readAsDataURL(r)}};S.addEventListener("change",(()=>k(S,q))),b.addEventListener("change",(()=>{x.innerHTML="";const e=document.createElement("img");e.style.width="100%",e.style.height="100%",e.alt="Фотография жилья",x.appendChild(e),k(b,e)}));const w=()=>{x.innerHTML="",q.src="./img/muffin-grey.svg"},E={lat:35.85,lng:139.76},C=document.querySelector(".ad-form"),$=C.querySelectorAll("fieldset"),V=document.querySelector(".map__filters"),A=V.children,F=C.querySelector("#address"),O=e=>{for(let t of e)t.disabled=!0},T=e=>{for(let t of e)t.disabled=!1};C.classList.add("ad-form--disabled"),O($),V.classList.add(".map__filters--disabled"),O(A);const j=e=>{Z.setLatLng([E.lat,E.lng]),e.reset(),F.value=`${E.lat.toFixed(5)}, ${E.lng.toFixed(5)}`,h(),c.style.border="none",u.style.border="none",f.style.border="none"};C.querySelector(".ad-form__reset").addEventListener("click",(e=>{e.preventDefault(),j(C),j(V),w(),o(oe)}));const M=()=>{i("success"),j(C),j(V),w(),o(oe)},H=()=>{i("error")};C.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);var r,o;r=M,o=H,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{e.ok?r():o()})).catch((()=>{o()}))}));const I=document.querySelector(".map__filters"),z=I.querySelector("#housing-type"),D=I.querySelector("#housing-price"),U=I.querySelector("#housing-rooms"),N=I.querySelector("#housing-guests"),P=I.querySelector("#filter-wifi"),R=I.querySelector("#filter-dishwasher"),W=I.querySelector("#filter-parking"),B=I.querySelector("#filter-washer"),G=I.querySelector("#filter-elevator"),J=I.querySelector("#filter-conditioner"),K={any:e=>e,low:e=>e<=1e4,high:e=>e>=5e4,middle:e=>e>=1e4&&e<=5e4},Q=L.map("map-canvas").on("load",(()=>{C.classList.remove("ad-form--disabled"),T($),F.value=`${E.lat.toFixed(5)}, ${E.lng.toFixed(5)}`,F.setAttribute("readonly","readonly"),h()})).setView({lat:E.lat,lng:E.lng},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(Q);const X=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),Y=L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),Z=L.marker({lat:E.lat,lng:E.lng},{draggable:!0,icon:X}).addTo(Q);Z.on("moveend",(e=>{const t=e.target.getLatLng();F.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`}));let ee=[];const te=o=>{re(),o.forEach(((o,n)=>{const{location:a}=o,i=new L.marker({lat:a.lat,lng:a.lng},{icon:Y});ee.push(i),ee[n].addTo(Q).bindPopup((({author:o,offer:n})=>{const a=r.cloneNode(!0),i=a.querySelector(".popup__features"),l=a.querySelector(".popup__photos");return a.querySelector(".popup__avatar").src=o.avatar,a.querySelector(".popup__title").textContent=n.title,a.querySelector(".popup__text--address").textContent=n.address,a.querySelector(".popup__text--price").textContent=`${n.price} ₽/ночь`,a.querySelector(".popup__type").textContent=e[n.type],a.querySelector(".popup__text--capacity").textContent=`${n.rooms} комнаты для ${n.guests} гостей`,a.querySelector(".popup__text--time").textContent=`Заезд после ${n.checkin}, выезд до ${n.checkout}`,i.innerHTML=n.features.map((e=>`<li class="popup__feature popup__feature--${e}"></li>`)).join(""),t(i),a.querySelector(".popup__description").textContent=n.description,l.innerHTML=n.photos.map((e=>`<img src="${e}" class="popup__photo" width="45" height="40" alt="Фотография жилья">`)).join(""),t(l),a})(o),{keepInView:!0})}))},re=()=>{ee.forEach((e=>{Q.removeLayer(e)})),ee=[]},oe=e=>{(e=>{const t=e.slice(0,10);te(t)})(e),V.classList.remove(".map__filters--disabled"),T(A);const t=_.debounce((()=>{let t=e.filter((e=>(e=>{let t=e.offer.type===z.value;return"any"===z.value||t})(e)&&(e=>{let t=e.offer.price;return K[D.value](t)})(e)&&(e=>{let t=e.offer.rooms===parseInt(U.value,10);return"any"===U.value||t})(e)&&(e=>{let t=e.offer.guests===parseInt(N.value,10);return"any"===N.value||t})(e)&&(e=>{let t=-1!==e.offer.features.indexOf("wifi"),r=-1!==e.offer.features.indexOf("dishwasher"),o=-1!==e.offer.features.indexOf("parking"),n=-1!==e.offer.features.indexOf("washer"),a=-1!==e.offer.features.indexOf("elevator"),i=-1!==e.offer.features.indexOf("conditioner"),l=!0;return l=l&&(!P.checked||t),l=l&&(!R.checked||r),l=l&&(!W.checked||o),l=l&&(!B.checked||n),l=l&&(!G.checked||a),l=l&&(!J.checked||i),l})(e)));t=t.slice(0,10),te(t)}),500);I.addEventListener("change",t)};o(oe,(e=>{const t=document.querySelector(".map"),r=document.createElement("div");r.classList.add("alert-message"),r.textContent=e,t.append(r)})),n.appendChild(a("success")),n.appendChild(a("error"))})();
//# sourceMappingURL=main.bundle.js.map